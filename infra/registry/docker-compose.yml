version: "3.9"

services:
  registry:
    image: registry:2
    container_name: registry
    restart: always  # Importante: Si la VPS se reinicia, el registry arranca solo
    ports:
      - "5000:5000"
    environment:
      # üëá ESTA ES LA L√çNEA M√ÅGICA QUE FALTABA
      REGISTRY_STORAGE_DELETE_ENABLED: "true"
      # Esta l√≠nea asegura que las im√°genes se guarden donde el volumen espera
      REGISTRY_STORAGE_FILESYSTEM_ROOTDIRECTORY: /var/lib/registry
    volumes:
      # Esto hace que si borras el contenedor, NO pierdas las im√°genes de tus clientes
      - registry_data:/var/lib/registry

volumes:
  registry_data:
